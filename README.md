# Excel テキスト統一システム

A.B２つのエクセルファイルのテキストを統一するWebアプリケーションです。Gemini AIを使用して、ベースファイルに基づいてテキストの正規化と修正を自動実行します。

## 機能

- 📁 **ファイルアップロード**: 抽出ファイル（ベース）と提出ファイル（修正対象）をWebUIでアップロード
- 🤖 **AI処理**: Gemini APIを使用したインテリジェントなテキスト統一
- 📊 **結果出力**: 3つのシートを含むExcelファイルを生成
  - 1枚目: 抽出するテキストのファイル
  - 2枚目: 誤った転記のファイル  
  - 3枚目: 正しい転記のファイル
- 📋 **差異記録**: 修正内容を別シートで詳細記録
- 🔤 **文字種統一**: 半角/全角、大文字/小文字を自動調整

## セットアップ

### 1. 必要なパッケージのインストール

```bash
pip install -r requirements.txt
```

### 2. Gemini API キーの設定

1. [Google AI Studio](https://makersuite.google.com/app/apikey)でAPIキーを取得
2. アプリケーション内で設定（デフォルトキーが設定済み）

### 3. アプリケーションの起動

```bash
streamlit run app.py
```

ブラウザで `http://localhost:8501` にアクセス

## 使用方法

### 1. ファイルアップロード
- **抽出ファイル**: 正しいテキストのベースとなるExcelファイル
- **提出ファイル**: 修正が必要なExcelファイル

### 2. 処理実行
- 「テキスト統一処理を実行」ボタンをクリック
- AIが自動でテキストを比較・統一

### 3. 結果確認
- 検出された差異がUI上に表示
- 修正理由と信頼度を確認

### 4. ファイルダウンロード
- 「統一済みファイルをダウンロード」から結果を取得
- タイムスタンプ付きファイル名で保存

## ファイル構成

```
taiheiyou/
├── app.py              # メインアプリケーション
├── excel_processor.py  # Excel処理ロジック
├── text_unifier.py     # テキスト統一・AI処理
├── requirements.txt    # 依存パッケージ
└── README.md          # このファイル
```

## 処理の流れ

1. **ファイル読み込み**: 両ファイルのExcelデータを解析
2. **テキスト抽出**: 抽出ファイルから正しいテキストを収集
3. **類似度判定**: 文字列類似度で候補テキストを検索
4. **AI判定**: Gemini APIで修正の妥当性を確認
5. **統一処理**: 承認された修正を適用
6. **結果出力**: 3シート構成のExcelファイルを生成

## 技術仕様

- **Frontend**: Streamlit (Webベースユーザーインターフェース)
- **Backend**: Python, pandas, openpyxl
- **AI処理**: Google Gemini API (gemini-pro)
- **文字列処理**: difflib, 正規表現

## トラブルシューティング

### APIエラーの場合
- Gemini APIキーが正しく設定されているか確認
- ネットワーク接続を確認
- API利用制限に達していないか確認

### ファイル読み込みエラーの場合
- Excelファイル形式（.xlsx, .xls）を確認
- ファイルが破損していないか確認
- ファイルサイズが適切か確認

### 処理が遅い場合
- 大量のテキストがある場合、処理時間が長くなります
- API呼び出し制限により待機時間が発生する場合があります

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## サポート

問題が発生した場合は、エラーメッセージをコピーして開発チームまでお問い合わせください。 